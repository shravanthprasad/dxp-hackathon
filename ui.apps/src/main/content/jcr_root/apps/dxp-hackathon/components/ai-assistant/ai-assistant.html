<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
<!-- Button to trigger the modal -->
<button type="button" class="btn btn-primary js-viewer-modal" data-toggle="modal" data-target="#myModal">
    AI Summarize!
</button>
<!-- The Modal -->
<div class="modal" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h6 class="modal-title text-body">Chat with our AI Assistant!</h6>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div id="js-chatbot-output" style="display:none"></div>

            <!-- Modal Body -->
            <div class="modal-body assistant-model-content text-body">
                <input type="textarea" class="js-chatbot-message" placeholder="Type your message here..."></input>
                <button type="submit" class="btn btn-primary js-chatbot-submit">Seach</button>
                <div class="spinner-border d-none" id="spinner" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
                <div class="js-chatbot-content text-body"></div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary js-chatbot-clear" data-dismiss="modal">Clear</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<script>
    // Function to extract text from each page of PDF
    window.onload = function () {
        async function extractTextFromPDF(url) {
            const loadingTask = pdfjsLib.getDocument(url);

            try {
                const pdf = await loadingTask.promise;
                const numPages = pdf.numPages;
                const outputDiv = document.getElementById('js-chatbot-output');
                outputDiv.innerHTML = ''; // Clear previous content

                // Iterate through each page
                for (let pageNumber = 1; pageNumber <= numPages; pageNumber++) {
                    const page = await pdf.getPage(pageNumber);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(function (item) {
                        return item.str;
                    }).join(' ');

                    // Display the text content of the page
                    const pageDiv = document.createElement('div');
                    pageDiv.innerHTML = '<h3>Page ' + pageNumber + '</h3><p>' + pageText + '</p>';
                    outputDiv.appendChild(pageDiv);
                }
            } catch (error) {
                console.error('Error loading PDF:', error);
                const outputDiv = document.getElementById('output');
                outputDiv.innerHTML = 'Error loading PDF: ' + error.message;
            }
        }

        const pdfUrl = document.querySelector('.cmp-pdfviewer')?.dataset?.cmpDocumentPath;
        console.log('pdfurl', pdfUrl);
        if (pdfUrl) {
            extractTextFromPDF(pdfUrl);
        }
    }
</script>